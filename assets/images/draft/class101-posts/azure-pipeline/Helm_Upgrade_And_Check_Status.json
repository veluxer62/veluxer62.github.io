{"tasks":[{"environment":{},"displayName":"Download Inventory Helm Chart","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"source":"current","project":"","pipeline":"","preferTriggeringPipeline":"false","runVersion":"latest","runBranch":"refs/heads/master","runId":"","tags":"","allowPartiallySucceededBuilds":"false","allowFailedBuilds":"false","artifact":"$(artifact-name)","patterns":"$(artifact-name)/**","path":"$(System.DefaultWorkingDirectory)"},"task":{"id":"61f2a582-95ae-4948-b34d-a1b3c4f6a737","versionSpec":"2.*","definitionType":"task"}},{"environment":{},"displayName":"Helm Upgrade","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"awsCredentials":"d62f0f46-8304-456f-af1c-2a92ff56ad49","regionName":"ap-northeast-2","arguments":"","scriptType":"inline","filePath":"","inlineScript":"shortHash=$(Build.SourceVersion)\nhelm upgrade --install -n $(k8s-namespace) $(k8s-service-name) $(helm-directory) -f $(helm-value-file) --set image.versionTag=${shortHash:0:7}","disableAutoCwd":"false","workingDirectory":"","failOnStandardError":"false"},"task":{"id":"3aea39d2-803c-43c7-b8d6-8e71b670f816","versionSpec":"1.*","definitionType":"task"}},{"environment":{},"displayName":"Deploy Status Check","alwaysRun":false,"continueOnError":false,"condition":"succeeded()","enabled":true,"timeoutInMinutes":0,"inputs":{"awsCredentials":"d62f0f46-8304-456f-af1c-2a92ff56ad49","regionName":"ap-northeast-2","arguments":"","scriptType":"inline","filePath":"","inlineScript":"DEPLOY_NAME=$(k8s-deployment-name)\nNAMESPACE=$(k8s-namespace)\n\nCMD=\"kubectl rollout status deployment $DEPLOY_NAME -n $NAMESPACE\"\n\nif ! $CMD; then\n    echo \"Rolling back deployment!\" >&2\n    kubectl rollout undo deployment $DEPLOY_NAME -n $NAMESPACE\n    exit 1\nfi","disableAutoCwd":"false","workingDirectory":"","failOnStandardError":"false"},"task":{"id":"3aea39d2-803c-43c7-b8d6-8e71b670f816","versionSpec":"1.*","definitionType":"task"}}],"runsOn":["Agent","DeploymentGroup"],"revision":2,"createdBy":{"displayName":"케이","id":"494eff63-8e0a-6cbb-a2bc-7cec9c29a94f","uniqueName":"k@101.inc"},"createdOn":"2020-12-03T04:36:03.170Z","modifiedBy":{"displayName":"케이","id":"494eff63-8e0a-6cbb-a2bc-7cec9c29a94f","uniqueName":"k@101.inc"},"modifiedOn":"2020-12-03T04:42:42.503Z","comment":"","id":"115b58d0-02cc-4ca3-ac55-3544ea1446fd","name":"Helm Upgrade And Check Status","version":{"major":1,"minor":0,"patch":0,"isTest":false},"iconUrl":"https://cdn.vsassets.io/v/M178_20201119.2/_content/icon-meta-task.png","friendlyName":"Helm Upgrade And Check Status","description":"","category":"Deploy","definitionType":"metaTask","author":"케이","demands":[],"groups":[],"inputs":[{"aliases":[],"options":{},"properties":{},"name":"artifact-name","label":"artifact-name","defaultValue":"","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"helm-directory","label":"helm-directory","defaultValue":"","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"helm-value-file","label":"helm-value-file","defaultValue":"","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"k8s-deployment-name","label":"k8s-deployment-name","defaultValue":"","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"k8s-namespace","label":"k8s-namespace","defaultValue":"","required":true,"type":"string","helpMarkDown":"","groupName":""},{"aliases":[],"options":{},"properties":{},"name":"k8s-service-name","label":"k8s-service-name","defaultValue":"","required":true,"type":"string","helpMarkDown":"","groupName":""}],"satisfies":[],"sourceDefinitions":[],"dataSourceBindings":[],"instanceNameFormat":"Task group: Helm Upgrade And Check Status $(artifact-name)","preJobExecution":{},"execution":{},"postJobExecution":{}}